<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Action non autorisée - TheWalkingDog</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bitter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #E8DDD3;
      font-family: 'Bitter', Georgia, serif;
      padding: 1rem;
    }

    .error-container {
      text-align: center;
      max-width: 500px;
      width: 100%;
      background: #FFFFFF;
      border-radius: 20px;
      padding: 2rem 1.5rem;
      box-shadow: 0 10px 40px rgba(163, 181, 217, 0.3);
    }

    .error-code {
      font-size: 5rem;
      font-weight: 700;
      color: #1E3A5F;
      line-height: 1;
      margin-bottom: 0.25rem;
    }

    .error-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1E3A5F;
      margin-bottom: 0.5rem;
    }

    .error-message {
      font-size: 0.9rem;
      color: #8B8377;
      line-height: 1.5;
      margin-bottom: 1rem;
    }

    .game-container {
      position: relative;
      width: 100%;
      height: 200px;
      background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 75%, #90EE90 75%, #228B22 100%);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 1rem;
      cursor: pointer;
      border: 2px solid #A3B5D9;
      touch-action: none;
    }

    #gameCanvas {
      width: 100%;
      height: 100%;
    }

    .game-instructions {
      font-size: 0.8rem;
      color: #A3B5D9;
      margin-bottom: 1rem;
    }

    .score-display {
      font-size: 0.9rem;
      color: #1E3A5F;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .error-btn {
      display: inline-block;
      padding: 0.85rem 2rem;
      background: #1E3A5F;
      color: #FFFFFF;
      text-decoration: none;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    .error-btn:hover {
      background: #2c4a6e;
      transform: translateY(-2px);
    }

    .game-over-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.1rem;
      font-weight: 700;
      color: #1E3A5F;
      background: rgba(255,255,255,0.95);
      padding: 0.75rem 1.25rem;
      border-radius: 8px;
      display: none;
      text-align: center;
    }

      </style>
</head>

<body>
  <div class="error-container">
    <div class="error-code">422</div>
    <h1 class="error-title">Oups ! Accès interdit</h1>
    <p class="error-message">Ce toutou n'a pas le droit d'aller là... Mais il peut attraper des friandises !</p>

    <div class="game-container" id="gameContainer">
      <canvas id="gameCanvas"></canvas>
      <div class="game-over-text" id="gameOverText">Partie terminee !<br>Clique pour rejouer</div>
    </div>

    <p class="game-instructions">Utilise les flèches ou glisse pour déplacer le chien</p>
    <p class="score-display">Friandises: <span id="score">0</span> | Record: <span id="highScore">0</span> | Vies: <span id="lives">3</span></p>

    <a href="/" class="error-btn">Retour à l'accueil</a>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const gameContainer = document.getElementById('gameContainer');
    const scoreElement = document.getElementById('score');
    const highScoreElement = document.getElementById('highScore');
    const livesElement = document.getElementById('lives');
    const gameOverText = document.getElementById('gameOverText');

    // Game state
    let gameRunning = false;
    let gameStarted = false;
    let score = 0;
    let lives = 3;
    let highScore = localStorage.getItem('treatGameHighScore') || 0;
    highScoreElement.textContent = highScore;

    function getGroundY() {
      return canvas.height - 25;
    }

    // Dog (bowl/catcher)
    const dog = {
      x: 0,
      y: 0,
      width: 60,
      height: 40,
      speed: 8
    };

    function resizeCanvas() {
      canvas.width = gameContainer.offsetWidth;
      canvas.height = gameContainer.offsetHeight;
      // Reset dog position
      dog.x = canvas.width / 2 - 30;
      dog.y = getGroundY() - 35;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Treats falling
    let treats = [];
    let badItems = [];
    let spawnTimer = 0;
    let difficultyTimer = 0;
    let spawnRate = 60;

    // Controls
    let moveLeft = false;
    let moveRight = false;
    let touchStartX = 0;

    // Draw dog with bowl
    function drawDog() {
      // Body
      ctx.fillStyle = '#8B4513';
      ctx.fillRect(dog.x + 15, dog.y + 5, 30, 25);

      // Head
      ctx.fillRect(dog.x + 40, dog.y - 5, 18, 20);

      // Ear
      ctx.fillStyle = '#654321';
      ctx.fillRect(dog.x + 52, dog.y - 10, 6, 10);

      // Eye
      ctx.fillStyle = '#000';
      ctx.fillRect(dog.x + 50, dog.y, 3, 3);

      // Tongue (happy!)
      ctx.fillStyle = '#FF69B4';
      ctx.fillRect(dog.x + 55, dog.y + 10, 4, 6);

      // Tail wagging
      ctx.fillStyle = '#8B4513';
      const tailWag = Math.sin(Date.now() / 80) * 8;
      ctx.fillRect(dog.x + 5, dog.y + tailWag, 12, 5);

      // Legs
      ctx.fillStyle = '#654321';
      ctx.fillRect(dog.x + 18, dog.y + 28, 6, 12);
      ctx.fillRect(dog.x + 36, dog.y + 28, 6, 12);

      // Bowl in mouth
      ctx.fillStyle = '#C0C0C0';
      ctx.beginPath();
      ctx.ellipse(dog.x + 30, dog.y + 2, 18, 8, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#A0A0A0';
      ctx.beginPath();
      ctx.ellipse(dog.x + 30, dog.y + 2, 14, 5, 0, 0, Math.PI * 2);
      ctx.fill();
    }

    // Draw treat (bone)
    function drawTreat(t) {
      ctx.fillStyle = '#F5DEB3';
      // Bone shape
      ctx.fillRect(t.x + 5, t.y + 8, 15, 6);
      ctx.beginPath();
      ctx.arc(t.x + 5, t.y + 11, 5, 0, Math.PI * 2);
      ctx.arc(t.x + 20, t.y + 11, 5, 0, Math.PI * 2);
      ctx.fill();
    }

    // Draw bad item (shoe)
    function drawBadItem(b) {
      ctx.fillStyle = '#4A4A4A';
      // Shoe shape
      ctx.fillRect(b.x, b.y + 5, 20, 12);
      ctx.fillRect(b.x + 15, b.y + 10, 10, 7);
      ctx.fillStyle = '#2A2A2A';
      ctx.fillRect(b.x, b.y, 8, 8);
    }

    // Draw sun
    function drawSun() {
      ctx.fillStyle = '#FFD700';
      ctx.beginPath();
      ctx.arc(canvas.width - 40, 35, 20, 0, Math.PI * 2);
      ctx.fill();

      // Rays
      ctx.strokeStyle = '#FFD700';
      ctx.lineWidth = 2;
      for (let i = 0; i < 8; i++) {
        const angle = (i / 8) * Math.PI * 2;
        ctx.beginPath();
        ctx.moveTo(canvas.width - 40 + Math.cos(angle) * 25, 35 + Math.sin(angle) * 25);
        ctx.lineTo(canvas.width - 40 + Math.cos(angle) * 35, 35 + Math.sin(angle) * 35);
        ctx.stroke();
      }
    }

    // Draw ground
    function drawGround() {
      const groundY = getGroundY();
      ctx.fillStyle = '#228B22';
      ctx.fillRect(0, groundY, canvas.width, 30);
      ctx.fillStyle = '#32CD32';
      for (let i = 0; i < canvas.width; i += 12) {
        ctx.fillRect(i, groundY - 3, 2, 6);
      }
    }

    // Spawn items
    function spawnItems() {
      spawnTimer++;
      if (spawnTimer >= spawnRate) {
        const x = Math.random() * (canvas.width - 30);
        if (Math.random() > 0.25) {
          treats.push({ x, y: -20, speed: 2 + Math.random() * 2 });
        } else {
          badItems.push({ x, y: -20, speed: 2.5 + Math.random() * 1.5 });
        }
        spawnTimer = 0;
      }

      // Increase difficulty
      difficultyTimer++;
      if (difficultyTimer >= 500 && spawnRate > 30) {
        spawnRate -= 5;
        difficultyTimer = 0;
      }
    }

    // Check collision
    function checkCollision(item) {
      return item.x < dog.x + dog.width - 10 &&
             item.x + 25 > dog.x + 10 &&
             item.y + 20 > dog.y &&
             item.y < dog.y + 15;
    }

    // Game loop
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Sky
      ctx.fillStyle = '#87CEEB';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      drawSun();
      drawGround();

      if (gameRunning) {
        // Move dog
        if (moveLeft && dog.x > 0) dog.x -= dog.speed;
        if (moveRight && dog.x < canvas.width - dog.width) dog.x += dog.speed;

        spawnItems();

        // Update treats
        for (let i = treats.length - 1; i >= 0; i--) {
          treats[i].y += treats[i].speed;

          if (checkCollision(treats[i])) {
            treats.splice(i, 1);
            score++;
            scoreElement.textContent = score;
            continue;
          }

          if (treats[i].y > canvas.height) {
            treats.splice(i, 1);
          }
        }

        // Update bad items
        for (let i = badItems.length - 1; i >= 0; i--) {
          badItems[i].y += badItems[i].speed;

          if (checkCollision(badItems[i])) {
            badItems.splice(i, 1);
            lives--;
            livesElement.textContent = lives;
            if (lives <= 0) {
              gameRunning = false;
              gameOverText.style.display = 'block';
              if (score > highScore) {
                highScore = score;
                localStorage.setItem('treatGameHighScore', highScore);
                highScoreElement.textContent = highScore;
              }
            }
            continue;
          }

          if (badItems[i].y > canvas.height) {
            badItems.splice(i, 1);
          }
        }
      }

      // Draw items
      treats.forEach(t => drawTreat(t));
      badItems.forEach(b => drawBadItem(b));

      drawDog();

      // Start message
      if (!gameStarted) {
        ctx.fillStyle = 'rgba(30, 58, 95, 0.9)';
        ctx.font = 'bold 14px Bitter';
        ctx.textAlign = 'center';
        ctx.fillText('Utilise les flèches pour commencer', canvas.width / 2, canvas.height / 2);
      }

      requestAnimationFrame(gameLoop);
    }

    // Reset game
    function resetGame() {
      treats = [];
      badItems = [];
      score = 0;
      lives = 3;
      spawnRate = 60;
      spawnTimer = 0;
      difficultyTimer = 0;
      dog.x = canvas.width / 2 - 30;
      scoreElement.textContent = score;
      livesElement.textContent = lives;
      gameRunning = true;
      gameStarted = true;
      gameOverText.style.display = 'none';
    }

    // Keyboard controls
    document.addEventListener('keydown', (e) => {
      if (e.code === 'ArrowLeft') {
        moveLeft = true;
        if (!gameStarted) { gameStarted = true; gameRunning = true; }
      }
      if (e.code === 'ArrowRight') {
        moveRight = true;
        if (!gameStarted) { gameStarted = true; gameRunning = true; }
      }
      if (!gameRunning && lives <= 0) resetGame();
    });

    document.addEventListener('keyup', (e) => {
      if (e.code === 'ArrowLeft') moveLeft = false;
      if (e.code === 'ArrowRight') moveRight = false;
    });

    // Touch controls
    gameContainer.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (!gameRunning && lives <= 0) {
        resetGame();
        return;
      }
      if (!gameStarted) { gameStarted = true; gameRunning = true; }
      touchStartX = e.touches[0].clientX;
    });

    gameContainer.addEventListener('touchmove', (e) => {
      e.preventDefault();
      const touchX = e.touches[0].clientX;
      const diff = touchX - touchStartX;
      if (diff > 10) {
        moveRight = true;
        moveLeft = false;
      } else if (diff < -10) {
        moveLeft = true;
        moveRight = false;
      }
    });

    gameContainer.addEventListener('touchend', () => {
      moveLeft = false;
      moveRight = false;
    });

    gameContainer.addEventListener('click', () => {
      if (!gameRunning && lives <= 0) resetGame();
    });

    gameLoop();
  </script>
</body>
</html>
