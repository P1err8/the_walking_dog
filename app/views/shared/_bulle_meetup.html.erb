<div class="bulle-meetup">
  <div class="bulle-meetup__image">
    <img src="<%= image_url.presence || asset_path('meetup-placeholder.svg') %>"
         alt="<%= name %>"
         class="bulle-meetup__img"
          onerror="this.onerror=null;this.src='<%= asset_path('meetup-placeholder.svg') %>'" />
  </div>
  <div class="bulle-meetup__content">
    <div class="bulle-meetup__header">
      <span class="bulle-meetup__type"><%= type.presence || 'Point de rencontre' %></span>
    </div>
    <h3 class="bulle-meetup__title"><%= name %></h3>
    <p class="bulle-meetup__location"><%= location.presence || 'Lyon, France' %></p>
    <% unless controller_name == 'meet_ups' && action_name == 'show' %>
      <div class="bulle-meetup__info">
        <div class="bulle-meetup__distance">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M8 1v14M8 1L4 5M8 1l4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="distance-value">Calcul...</span>
        </div>
        <div class="bulle-meetup__duration">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
            <path d="M8 5v3l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span class="duration-value">Calcul...</span>
        </div>
      </div>
    <% end %>
    <% if point.meet_ups.any?(&:active?) %>
      <% active_meetup = point.meet_ups.active.last %>
      <% dogs = active_meetup.dogs %>

      <% if dogs.any? %>
        <div class="bulle-meetup__dogs">
          <div class="bulle-meetup__dogs-avatars">
            <% dogs.first(3).each do |dog| %>
              <%= link_to dog_path(dog), class: "bulle-meetup__dog-link" do %>
                <% if dog.url_picture.present? %>
                  <%= image_tag dog.url_picture, alt: dog.name, class: "bulle-meetup__dog-avatar-small" %>
                <% else %>
                  <div class="bulle-meetup__dog-avatar-small placeholder">üêï</div>
                <% end %>
              <% end %>
            <% end %>
          </div>
          <div class="bulle-meetup__dogs-races">
            <% dogs.each_with_index do |dog, index| %>
              <span class="bulle-meetup__dog-race"><%= dog.race %></span><%= index < dogs.size - 1 ? ' - ' : '' %>
            <% end %>
          </div>
        </div>
      <% end %>

      <% unless controller_name == 'meet_ups' && action_name == 'show' %>
        <%= simple_form_for [active_meetup, Participation.new] do |f| %>
          <%= f.submit "Rejoindre la Rencontre", class: "btn btn-primary btn-sm" %>
        <% end %>
      <% end %>
    <% else %>
      <% unless controller_name == 'meet_ups' && action_name == 'show' %>
        <%= simple_form_for MeetUp.new do |f| %>
          <%# Champ cach√© pour lier le meetup au point actuel %>
          <%= f.input :point_id, as: :hidden, input_html: { value: point_id } %>
          <%= f.submit "Cr√©er une Rencontre", class: "btn btn-primary btn-sm" %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
