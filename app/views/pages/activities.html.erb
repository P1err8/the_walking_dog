<% content_for :title, "Mes activités" %>

<div class="activities-container">
  <div class="activities-list">
    <% activities = (@walkings.to_a + @participations.to_a).sort_by(&:created_at).reverse %>
    <% activities.each do |activity| %>
      <% if activity.is_a?(Walking) && activity.coordinates.present? %>
        <div class="activity-card">
          <!-- Header: User & Date -->
          <div class="activity-header">
            <div class="user-avatar">
              <% if current_user.dogs.any? && current_user.dogs.first.url_picture.present? %>
                <%= image_tag current_user.dogs.first.url_picture, class: "avatar-img" %>
              <% else %>
                <img src="https://i.pravatar.cc/150?img=12" class="avatar-img">
              <% end %>
            </div>
            <div class="user-info">
              <strong><%= current_user.email.split('@').first.capitalize %></strong>
              <span class="date"><%= activity.created_at.in_time_zone('Paris').strftime("%d %b à %H:%M") %></span>
            </div>
          </div>
          <!-- Title -->
          <h3>Promenade</h3>
          <!-- The Static Map -->
          <div class="activity-map">
            <%= image_tag static_map_url(activity), alt: "Itinéraire de la balade", class: "static-map-img" %>
          </div>
          <!-- Stats Grid -->
          <div class="activity-stats">
            <div class="stat">
              <i class="fa-solid fa-route"></i>
              <span class="value"><strong><%= activity.calculated_distance ? "#{activity.calculated_distance} km" : "- km" %></strong></span>
            </div>
            <div class="stat">
              <i class="fa-regular fa-clock"></i>
              <span class="value"><strong><%= activity.calculated_duration ? "#{activity.calculated_duration} min" : "- min" %></strong></span>
            </div>
          </div>
        </div>
      <% elsif activity.is_a?(Participation) %>
        <div class="activity-card">
          <!-- Header: User & Date -->
          <div class="activity-header">
            <div class="user-avatar">
              <% if current_user.dogs.any? && current_user.dogs.first.url_picture.present? %>
                <%= image_tag current_user.dogs.first.url_picture, class: "avatar-img" %>
              <% else %>
                <img src="https://i.pravatar.cc/150?img=12" class="avatar-img">
              <% end %>
            </div>
            <div class="user-info">
              <strong><%= current_user.email.split('@').first.capitalize %></strong>
              <span class="date"><%= activity.created_at.in_time_zone('Paris').strftime("%d %b à %H:%M") %></span>
            </div>
          </div>
          <!-- Title -->
          <h3>Rencontre : <%= activity.meet_up.point.name %></h3>
          <!-- The Static Map -->
          <div class="activity-map">
            <%= image_tag static_marker_map_url(activity.meet_up.point), alt: "Lieu de rencontre", class: "static-map-img border-bottom" %>
          </div>
        </div>
      <% end %>
    <% end %>
    <% if activities.empty? %>
      <p class="no-activities">Aucune activité enregistrée pour le moment.</p>
    <% end %>
  </div>
</div>
