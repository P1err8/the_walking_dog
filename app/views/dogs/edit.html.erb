<% content_for :title, "Modifier #{@dog.name}" %>

<div class="dog-show-container">
  <div class="dog-card">
    <%= simple_form_for @dog, html: { multipart: true, class: "dog-edit-form" } do |f| %>

      <div class="dog-profile-header">
        <div class="dog-photo-upload">
          <label for="dog_photo" class="dog-photo-label">
            <% if @dog.photo.attached? %>
              <%= image_tag @dog.photo, class: "dog-photo-preview", alt: @dog.name %>
            <% elsif @dog.url_picture.present? %>
              <%= image_tag @dog.url_picture, class: "dog-photo-preview", alt: @dog.name %>
            <% else %>
              <div class="dog-photo-placeholder">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                  <circle cx="12" cy="13" r="3" stroke-width="2"/>
                </svg>
              </div>
            <% end %>
            <div class="dog-photo-overlay">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                <circle cx="12" cy="13" r="3" stroke-width="2"/>
              </svg>
              <span>Modifier</span>
            </div>
          </label>
          <%= f.file_field :photo, accept: "image/*", class: "dog-photo-input", id: "dog_photo" %>
        </div>
      </div>

      <div class="dog-edit-fields">
        <div class="dog-field-group">
          <label class="dog-field-label">Nom</label>
          <%= f.input :name, label: false, placeholder: "Nom du chien", wrapper: false, input_html: { class: "dog-field-input" } %>
        </div>

        <div class="dog-field-group">
          <label class="dog-field-label">Âge</label>
          <%= f.input :age, label: false, placeholder: "Âge en années", wrapper: false, input_html: { class: "dog-field-input", type: "number", min: 0 } %>
        </div>

        <div class="dog-field-group">
          <label class="dog-field-label">Race</label>
          <div data-controller="breed-list" class="dog-breed-wrapper">
            <input type="hidden" name="dog[race]" data-breed-list-target="hiddenInput" value="<%= @dog.race %>">
            <input type="text" data-action="input->breed-list#filter focus->breed-list#showList" data-breed-list-target="queryInput" placeholder="Rechercher une race..." autocomplete="off" value="<%= @dog.race %>" class="dog-field-input">
            <div class="breed-list d-none" data-breed-list-target="list">
              <% Dog::BREEDS.each do |breed| %>
                <a class="breed-suggestion" data-action="click->breed-list#select" data-breed="<%= breed %>"><%= breed %></a>
              <% end %>
            </div>
          </div>
        </div>

        <div class="dog-field-group">
          <label class="dog-field-label">Taille</label>
          <div class="dog-size-options">
            <%= f.collection_radio_buttons :size, [["Petit", "Petit"], ["Moyen", "Moyen"], ["Grand", "Grand"]], :last, :first do |b| %>
              <label class="dog-size-btn"><%= b.radio_button %><span><%= b.text %></span></label>
            <% end %>
          </div>
        </div>

        <div class="dog-field-group">
          <label class="dog-field-label">Personnalité</label>
          <div class="dog-tags-edit">
            <%= f.collection_check_boxes :tag_ids, Tag.all, :id, :name, checked: @dog.tags.pluck(:id) do |b| %>
              <%= b.check_box(class: "d-none") %>
              <%= b.label(class: "dog-tag-btn") { b.object.name } %>
            <% end %>
          </div>
        </div>
      </div>

      <div class="dog-edit-actions">
        <%= link_to "Annuler", dog_path(@dog), class: "dog-cancel-btn" %>
        <%= f.submit "Enregistrer", class: "dog-save-btn" %>
      </div>

    <% end %>
  </div>
</div>
